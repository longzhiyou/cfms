angular.module("ng-backstretch",[]).directive("backstretch",["$window","$timeout",function(e,i){return{restrict:"A",scope:{images:"&backstretchImages",duration:"&backstretchDuration",fade:"&backstretchFade"},link:function(a,t,r){a.images=Array.isArray(a.images())?a.images():[a.images()];a.duration=a.duration()||5e3;a.fade=a.fade()||1;if(a.images.length===0){return false}var n={wrapper:{left:0,top:0,overflow:"hidden",margin:0,padding:0,height:"100%",width:"100%",zIndex:-999998,position:"absolute"},image:{position:"absolute",opacity:0,margin:0,padding:0,border:"none",width:"auto",height:"auto",maxHeight:"none",maxWidth:"none",zIndex:-999999,transition:"all "+a.fade+"s"}};a.wrapper=angular.element('<div class="backstretch"></div>');a.wrapper.css(n.wrapper);a.images.forEach(function(e,i,t){a.image=angular.element("<img>");a.image[0].src=e;a.image.css(n.image);a.wrapper.append(a.image)});t.append(a.wrapper);a.index=0;a.load=function(e){a.ratio=this.width/this.height;a.resize();a.show(a.index++)};a.resize=function(i){var r={left:0,top:0,width:"auto",height:"auto"};var n=t[0].offsetWidth,o=n,s=t[0].offsetHeight?t[0].offsetHeight:e.outerHeight,g=o/a.ratio,d;if(g>=s){d=(g-s)/2;r.top="-"+d+"px"}else{g=s;o=g*a.ratio;d=(o-n)/2;r.left="-"+d+"px"}r.width=o+"px";r.height=g+"px";a.wrapper.css({width:n,height:s});for(var h=0;h<a.wrapper.children().length;h++){var c=angular.element(a.wrapper.children()[h]);c.css(r)}};a.show=function(e){var t=a.wrapper.children()[e];a.image=angular.element(t);if(a.images.length===1){a.image.css({opacity:1});return}if(e>=a.images.length-1){a.index=0}a.image.css({opacity:1});i(function(){a.image.css({opacity:0})},a.duration);i(function(){a.show(a.index++)},a.duration)};a.image.bind("load",a.load);angular.element(e).bind("resize",a.resize)}}}]);